openapi: 3.0.0
info:
  title: Assignment of projects API
  description: API
  version: 1.0.0
servers:
  - url: 'http://localhost:3000/api'
paths:
  /auth/login:
    post:
      summary: Авторизация
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string, format: email }
                password: { type: string }
      responses:
        '200':
          description: Токен авторизации
          content:
            application/json:
              schema:
                type: object
                properties:
                  token: { type: string }
                  user: { $ref: '#/components/schemas/User' }
        '401':
          description: Неверный email или пароль
        '400':
          description: Неверный формат email

  /courses:
    get:
      summary: Список курсов
      security:
        - bearerAuth: []
      parameters:
        - name: semester
          in: query
          schema: { type: integer }
        - name: isActive
          in: query
          schema: { type: boolean }
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [title, semester, createdAt]
        - name: order
          in: query
          schema:
            type: string
            enum: [asc, desc]
      responses:
        '200':
          description: Список курсов
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Course'
        '401':
          description: Не авторизован

    post:
      summary: Создание курса
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title]
              properties:
                title: { type: string }
                description: { type: string }
      responses:
        '201':
          description: Курс создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Course'
        '400':
          description: Пустой title обязателен
        '401':
          description: Не авторизован
        '403':
          description: Нет прав на создание

  /courses/{id}:
    get:
      summary: Получение одного курса
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Данные курса
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Course'
        '404':
          description: Курс не найден
        '401':
          description: Не авторизован

    put:
      summary: Обновление курса
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
      responses:
        '200':
          description: Курс обновлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Course'
        '404':
          description: Курс не найден
        '400':
          description: Неверные данные
        '401':
          description: Не авторизован
        '403':
          description: Нет прав на редактирование

    delete:
      summary: Удаление курса
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Курс удален
        '404':
          description: Курс не найден
        '401':
          description: Не авторизован
        '403':
          description: Нет прав на удаление

  /courses/{id}/distribution:
    get:
      summary: Визуализация распределения по курсу
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Распределение по курсу
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DistributionResult'
        '404':
          description: Курс не найден
        '401':
          description: Не авторизован

  /courses/{id}/projects:
    get:
      summary: Список проектов определенного курса
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
        - name: teacherId
          in: query
          schema: { type: integer }
        - name: title
          in: query
          schema: { type: string }
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [title, createdAt]
        - name: order
          in: query
          schema: { type: string, enum: [asc, desc] }
      responses:
        '200':
          description: Список проектов
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Project'
        '404':
          description: Проекты курса не найдены
        '401':
          description: Не авторизован

  /projects:
    get:
      summary: Список всех проектов
      security:
        - bearerAuth: []
      parameters:
        - name: courseId
          in: query
          schema: { type: integer }
        - name: teacherId
          in: query
          schema: { type: integer }
        - name: title
          in: query
          schema: { type: string }
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [title, createdAt]
        - name: order
          in: query
          schema: { type: string, enum: [asc, desc] }
      responses:
        '200':
          description: Список проектов
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Project'
        '401':
          description: Не авторизован

    post:
      summary: Создание проекта
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [title, teacherId, courseId]
              properties:
                title:
                  type: string
                description:
                  type: string
                teacherId:
                  type: integer
                courseId:
                  type: integer
      responses:
        '201':
          description: Проект создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '400':
          description: Неверные данные
        '404':
          description: Курс или преподаватель не найдены
        '401':
          description: Не авторизован
        '403':
          description: Нет прав на создание

  /projects/{id}:
    get:
      summary: Получение проекта
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Данные проекта
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '404':
          description: Проект не найден
        '401':
          description: Не авторизован

    put:
      summary: Обновление проекта
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title: { type: string }
                description: { type: string }
                teacherId: { type: integer }
                courseId: { type: integer }
      responses:
        '200':
          description: Проект обновлен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '404':
          description: Проект не найден
        '400':
          description: Неверные данные
        '401':
          description: Не авторизован
        '403':
          description: Нет прав на редактирование

    delete:
      summary: Удаление проекта
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: Проект удален
        '404':
          description: Проект не найден
        '401':
          description: Не авторизован
        '403':
          description: Нет прав на удаление

  /assignments:
    get:
      summary: Общее распределение студентов по проектам
      parameters:
        - name: courseId
          in: query
          schema: { type: integer }
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [assignedAt, createdAt]
        - name: order
          in: query
          schema:
            type: string
            enum: [asc, desc]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Распределение
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Assignment' }
        '401':
          description: Не авторизован

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    User:
      type: object
      required: [id, firstName, lastName, email, role, group, ldapUid]
      properties:
        id: { type: integer }
        firstName: { type: string }
        lastName: { type: string }
        ldapUid: { type: string }
        email: { type: string, format: email }
        group: { type: integer }
        createdAt: { type: string, format: date-time }
        role:
          type: string
          enum: [student, teacher, admin]
    Course:
      type: object
      required: [id, title]
      properties:
        id: { type: integer }
        title: { type: string }
        semester: { type: integer }
        isActive: { type: boolean }
        description: { type: string }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
        registrationDeadline: { type: string, format: date-time }
    Project:
      type: object
      required: [id, title, teacherId, courseId]
      properties:
        id: { type: integer }
        title: { type: string }
        description: { type: string }
        teacherId: { type: integer }
        courseId: { type: integer }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    Assignment:
      type: object
      required: [studentId, projectId, courseId]
      properties:
        studentId: { type: integer }
        projectId: { type: integer }
        courseId: { type: integer }
        assignedAt: { type: string, format: date-time }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    DistributionResult:
      type: object
      properties:
        course:
          $ref: '#/components/schemas/Course'
        assignments:
          type: array
          items:
            $ref: '#/components/schemas/Assignment'
